FORMAT: X-1A
HOST: http://api.apiary.io/

# Apiary Dredd tests reporting API 

## Group Test Runs

### Test Run collection [/apis/{suite}/tests/runs]

- Parameters
  - suite (string, `jakubtest`) ... API suite domain identificator 

- Attributes
  - _id (string, `507f1f77bcf86cd799439011`) ... Unique object id. DO NOT USE IT WHEN CREATING! Used in post body only for purpose of testing this blueprint. 
  - blueprint (string) ... Blueprint used for the test run
  - public (bool) ... True if test run results are public 
  - agent (string) ... Who performed the test
  - agentRunUuid (string) ... Pseudo unique identificator generated by the agent
  - hostname (string) ... Host where test run was preformed
  - ci (boolean, optional) ... true if test was ran in CI
  - ciData (object, optional) ... CI details object
    - name (string, `travisci`) ... CI system identificator
    - buildId (string) ... Unique build ID in the particular CI system
    - buildNumber (string) ... Sequential build ID unique for the project
    - jobId (string) ... Unique build job ID in the particular CI systme
    - jobNumber (string) ... Seqential build job unique for the build
  - startedAt (integer) ... Unix timestamp when test run started in UTC
  - endedAt (integer) ... Unix timestamp when test run ended in UTC
  - status (string) ... Test run result
    - Values
      - `success`
      - `fail`
      - `running`
  - result (object) Result reportt
    - tests
    - failures
    - passes


#### Create test run [POST]

- Request (application/json)

    - Headers

        ```
        Authentication: Token aff888af9993db9ef70edf3c878ab521
        Accpept: application/json
        ```
  
    - Body

        ```
        {
          "_id": "507f1f77bcf86cd799439011",
          "blueprint": "My Api \n#My resourceName [/resourceName]\n# Action [GET]",
          "agent": "travisci",
          "agentRunUuid": "03b3de07-d354-4ba6-aa2e-28789b03c619",
          "public": true,
          "hostname": "kolotoc",
          "ci": true,
          "ciData": {
            "name": "travisci",
            "buildId": 1,
            "buildNumber": 1,
            "jobId": 1,
            "jobNumber": 1
          },
          "startedAt": 1381924285,
          "status": "started"
        }
        ```

- Response 201

    - Headers

        ```
        Content-Type: application/json; charset=utf-8
        ```

    - Body

        ```
        {
          "_id": "507f1f77bcf86cd799439011",
          "blueprint": "My Api \n#My resourceName [/resourceName]\n# Action [GET]",
          "public": "true",
          "agent": "Dredd/0.1.7 (Linux 3.2.0-23-generic; x64)",
          "agentRunUuid": "1383909911_4321",
          "hostname": "kolotoc",
          "ci": true,
          "ciData": {
            "name": "travisci",
            "buildId": 1,
            "buildNumber": 1,
            "jobId": 1,
            "jobNumber": 1
          },
          "startedAt": 1381924285,
          "status": "started"
        }
        ``` 

#### Retrieve multiple test runs [GET]

- Request 

    - Headers      
        
        ```
        Authentication: Token aff888af9993db9ef70edf3c878ab521
        ```

- Response 200 

    - Headers

        ```
        Content-Type: application/json; charset=utf-8
        ```

    - Body

        ```
        [
          {
            "_id": "507f1f77bcf86cd799439011",
            "blueprint": "My Api \n#My resourceName [/resourceName]\n# Action [GET]",
            "public": "true",
            "agent": "Dredd/0.1.7 (Linux 3.2.0-23-generic; x64)",
            "agentRunUuid": "1383909911_4321",
            "hostname": "kolotoc",
            "ci": true,
            "ciData": {
              "name": "travisci",
              "buildId": 1,
              "buildNumber": 1,
              "jobId": 1,
              "jobNumber": 1
            },
            "startedAt": 1381924285,
            "status": "started"
          }
        ]
        ```


### Test run [/apis/{suite}/tests/run/{id}]
  
- Parameters
  - suite (string, `jakubtest`) ... API suite domain identificator 
  - id (number, `507f1f77bcf86cd799439011`) ... Unique id of the run in Apiary


#### Update Attributes [PATCH]
  
- Request (application/json)

  - Headers

      ```
      Authentication: Token aff888af9993db9ef70edf3c878ab521
      ```

  - Body  

      ```
      {
        "endedAt": "1381924299",
        "status": "passed",
        "result": {
          "tests": 7,
          "failures": 0,
          "passes": 7
        }
      }
      ```

- Response 200
    - Headers

        ```
        Content-Type: application/json; charset=utf-8
        ```

    - Body

        ```
        {
          "_id": "507f1f77bcf86cd799439011",
          "blueprint": "My Api \n#My resourceName [/resourceName]\n# Action [GET]",
          "public": "true",
          "agent": "Dredd/0.1.7 (Linux 3.2.0-23-generic; x64)",
          "agentRunUuid": "1383909911_4321",
          "hostname": "kolotoc",
          "ci": true,
          "ciData": {
            "name": "travisci",
            "buildId": 1,
            "buildNumber": 1,
            "jobId": 1,
            "jobNumber": 1
          },
          "startedAt": 1381924285,
          "endedAt": "1381924299",
          "status": "passed",
          "result": {
            "tests": 7,
            "failures": 0,
            "passes": 7
          }
        }
        ```

### Retreive [GET]

- Response 200

    - Headers
  
        ```
        Content-Type: application/json; charset=utf-8
        ```
  
    - Body
  
        ```
        {
          "_id": "507f1f77bcf86cd799439011",
          "blueprint": "My Api \n#My resourceName [/resourceName]\n# Action [GET]",
          "public": "true",
          "agent": "Dredd/0.1.7 (Linux 3.2.0-23-generic; x64)",
          "agentRunUuid": "1383909911_4321",
          "hostname": "kolotoc",
          "ci": true,
          "ciData": {
            "name": "travisci",
            "buildId": 1,
            "buildNumber": 1,
            "jobId": 1,
            "jobNumber": 1
          },
          "startedAt": 1381924285,
          "endedAt": "1381924299",
          "status": "passed",
          "result": {
            "tests": 7,
            "failures": 0,
            "passes": 7
          }
        }
        ```

## Group Test Steps 

- Attributes
  - _id (string) ... Unique object id. DO NOT USE IT WHEN CREATING! Used in post body only for purpose of testing this blueprint.
  - testRunId (string) ... Reference to the parent test run identificator
  - origin (object) ... Origin path (position, location) of the step in the blueprint AST
    - resourceGroupName (string) ... Group name
    - resourceName (string) ... Resource name 
    - actionName (string) ... Action name
    - exampleName (string) ... Example name
  - duration (integer) ... Test duration in seconds
  - result (string) ... Result of step execution
    - Values
      - `passed`
      - `failed`
  - resultData (obejct) ... Data from step execution
    - request  ... [Real HTTP Request](https://www.relishapp.com/apiary/gavel/v/0-1/docs/data-model#http-request)
    - realResponse ... [Real HTTP response](https://www.relishapp.com/apiary/gavel/v/0-1/docs/data-model#http-response)
    - expected Response ... [Expected HTTP Response](https://www.relishapp.com/apiary/gavel/v/0-1/docs/data-model#expected-http-response)
    - result ... [Validation result output](https://www.relishapp.com/apiary/gavel/v/0-1/docs/data-validators-and-output-format#validators-output-format)
  - stepType (string, `exampleNameTransactionName`) ... Type of the step, shuould be HTTP or Cucumber for instance

### Test steps collection [/apis/{suite}/tests/steps{?testRunId,include}]

- Parameters
  - suite (string, `jakubtest`) ... API suite domain identificator 
  - testRunId (number, `507f1f77bcf86cd799439011`) ...  Retreive steps by run
  - include (string, optional, `resultData`) ... Include result data in the response body

#### Create [POST]

- Request (application/json)

  - Headers

      ```
      Authentication: Token aff888af9993db9ef70edf3c878ab521
      ```
  
  - Body
      
      ```
      { 
        "_id": "507c7f79bcf86cd7994f6c0e",
        "testRunId": "507f1f77bcf86cd799439011",
        "origin": {
          "resourceGroupName": "Machines",
          "resourceName": "Machines collection",
          "actionName": "Create a machine",
          "exampleName": ""
        }, 
        "duration": 12.345,
        "result": "fail",
        "stepType": "exampleNameTransaction",
        "result": "passed",
        "resultData": {
          "request": {
            "uri": "/",
            "method": "GET",
            "headers": {
              "content-type": "application/json"
            },
            "body": ""
          },
          "realResponse": {
            "statusCode": "200",
            "statusMessage": "OK",
            "headers": {
              "content-type": "application/json"
            },
            "body": "{\"name\": \"My api\", \"kind\": \"Cool API\"}"
          },
          "expectedResponse": {
            "statusCode": "200",
            "statusMessage": "OK",
            "headers": {
              "content-type": "application/json"
            },
            "body": "{\"kind\": \"Cool API\"}"
          },
          "result": {
            "statusCode": {
            },
            "headers": {
            },
            "body": {
            }
          }
        }
      }
      ```

- Response 201
  
  -  Headers

      ```
      Content-Type: application/json; charset=utf-8
      ```
  
  - Body
      
      ```
      { 
        "_id": "507c7f79bcf86cd7994f6c0e",
        "testRunId": "507f1f77bcf86cd799439011",
        "origin": {
          "resourceGroupName": "Machines",
          "resourceName": "Machines collection",
          "actionName": "Create a machine",
          "exampleName": ""
        }, 
        "duration": 12.345,
        "result": "fail",
        "stepType": "exampleNameTransaction",
        "result": "passed",
        "resultData": {}
      }
      ```

#### Retrieve [GET]

- Request (application/json)

  - Headers

      ```
      Authentication: Token aff888af9993db9ef70edf3c878ab521
      ```
  
- Response 200

  -  Headers

      ```
      Content-Type: application/json; charset=utf-8
      ```
  
  - Body

      ```
      [
        {
          "_id": "507c7f79bcf86cd7994f6c0e",
          "testRunId": "507f1f77bcf86cd799439011",
          "origin": {
            "resourceGroupName": "Machines",
            "resourceName": "Machines collection",
            "actionName": "Create a machine",
            "exampleName": ""
          }, 
          "duration": 12.345,
          "result": "passed",
          "stepType": "exampleNameTransaction",
          "resultData": {}
        }
      ]
      ```

### Test step [/apis/{suite}/tests/step/{id}{?include}]

####  Retreive [GET]

- Parameters
  - suite (string, `jakubtest`) ... API suite domain identificator 
  - id (number, `507c7f79bcf86cd7994f6c0e`) ... Unique identifier of test step in Apiary
  - include (string, optional, `resultData`) ... Include result data in the response body

- Request (application/json)

  - Headers

      ```
      Authentication: Token aff888af9993db9ef70edf3c878ab521
      ```
  
- Response 200 
  
  - Headers  
  
      ```
      Content-Type: application/json; charset=utf-8
      ```
  
  - Body

      ```
      {
        "_id": "507c7f79bcf86cd7994f6c0e",
        "testRunId": "507f1f77bcf86cd799439011",
        "origin": {
          "resourceGroupName": "Machines",
          "resourceName": "Machines collection",
          "actionName": "Create a machine",
          "exampleName": ""
        },
        "duration": 12.345,
        "result": "fail",
        "stepType": "exampleNameTransaction",
        "resultData": {
        }
      }
      ```