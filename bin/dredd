#!/usr/bin/env node
var cli = require('cli');
var Dredd = require('../lib/dredd');

cli.enable('version', 'status');
cli.setApp('./package.json');
cli.setUsage("dredd <path to blueprint> <api_endpoint> [OPTIONS]"
     + "\n\nExample: \n  " + "dredd ./apiary.md http://localhost:3000 --dry-run");

cli.parse(Dredd.options);

cli.main( function (args, options) {
  var argError = false;

  if (args[0] == undefined) {
    cli.error("Must specify path to blueprint file.\n");
    argError = true;
  }
  if (args[1] == undefined) {
    cli.error("Must specify api endpoint.\n");
    argError = true;
  }
  if (argError) {
    cli.getUsage();
  };

  configuration = {
    'blueprintPath': args[0],
    'server': args[1],
    'options': options
  }

  dredd = new Dredd(configuration);

  dredd.run(function(error){
    if (error) {
      cli.fatal(error);
    };
    process.exit(0);
  });

});
